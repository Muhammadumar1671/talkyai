{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="{% static 'chatbot/favicon.svg' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hub</title>
    <link rel="stylesheet" href="{% static 'chatbot/css/editbot.css' %}?v=1.0" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
    <style>
        .containers-starters {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* 3 containers per row */
    gap: 20px; /* Space between containers */
    justify-content: space-around;
    margin-top: 20px;
    width: 100%;
}

.containers {
    background: rgb(35, 35, 35);
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); /* Increased shadow for a futuristic look */
    padding: 20px;
    text-align: center;
    transition: transform 0.3s;
    cursor: pointer;
}

.containers:hover {
    transform: scale(1.05);
}

.containers img {
    width: 100px;
    height: auto;
    margin-bottom: 10px;
}

.containers p {
    font-size: 18px;
    color: #ffffff; /* Dark grey text color */
}


    </style>
  </head>
  <body class="dark-mode">
    <div class="main-section2">
      <div class="container">
        <div class="nav-bar2">
          <div class="logo2">
            <img src="{% static 'chatbot/img-edit-bot/logo.png' %}" alt="lg1" />
            <img src="{% static 'chatbot/img-edit-bot/TechRealm.png' %}" alt="logo-text" />
          </div>
       
          <div class="left-profile2">
            <button id="togle">Docs guide</button>
            <button id="toggle-button">
              <i class="fa-regular fa-moon"></i>
            </button>
            <img src="{% static 'chatbot/img-edit-bot/profile.png' %}" alt="profile" />
          </div>
        </div>
        <!-- <button id="toggle-button"><i class="fa-regular fa-moon"></i></button> -->
        
            
       
    </div>
   
    <div id="bot-keys-dropdown-container" style="display: flex; align-items: center; margin: 50px 0 10px 60px; width: 100%; max-width: 500px;">
        <label for="unique-edit-bot-id" style="font-size: 18px; color: white; margin-right: 10px; white-space: nowrap;">Name:</label>
        <select id="unique-edit-bot-id" style="
            flex-grow: 1;
            padding: 10px;
            font-size: 16px;
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            height: auto;
            overflow: visible;
        ">
            <!-- Dynamic options will be populated here -->
        </select>
    </div>
    

    
    
    
    <div class="Main-chat-box2">
      <div class="container">
        <div class="chat-prefix2">
          <div class="row">
            <div class="col-md-2">
              <div class="sidebar-custom">
                <li class="item-hover">Overview</li>
                <div class="icon-group">
                    <i class="fa-solid fa-message"></i>
                    <a id="chat-link" href="#">Chat</a>
                </div>
                <li class="item-hover">Manage</li>
                <div class="icon-group">
                    <p>>_</p>
                    <a id="api-link" href="#">API</a>
                </div>
                <div class="icon-group">
                    <i class="fa-solid fa-file"></i>
                    <a id="file-link" href="#">File</a>
                </div>
                <div class="icon-group">
                    <i class="fa-solid fa-gear"></i>
                    <a id="setting-link" href="#">Setting</a>
                </div>
                <li class="item-hover">Connect</li>
                <div class="icon-group">
                    <i class="fa-brands fa-telegram"></i>
                    <a href="#about">Telegram</a>
                </div>
                <div class="icon-group">
                    <i class="fa-brands fa-slack"></i>
                    <a href="#about">Slack</a>
                </div>
                <div class="icon-group">
                    <i class="fa-solid fa-caret-up"></i>
                    <a href="#about">Vercel</a>
                </div>
                <div class="icon-group">
                    <i class="fa-solid fa-laptop"></i>
                    <a href="#about">Embed</a>
                </div>
            </div>
            
           
             
            </div>
            <div class="col-md-10">
              <div class="file-content">
                <h3>Instructions</h3>
                <p>These are specific instructions you would give your bot</p>
                <hr>
              </div>

              <div class="containers-starters">
                <div class="containers" data-prompt="open">
                    <img src="/static/chatbot/img-create-bot/prompt1.svg" alt="Prompt 1">
                    <p>Open Response</p>
                </div>
                <div class="containers" data-prompt="strict">
                    <img src="/static/chatbot/img-create-bot/prompt2.svg" alt="Prompt 2">
                    <p>Very Strict Response</p>
                </div>
                <div class="containers" data-prompt="creative">
                    <img src="/static/chatbot/img-create-bot/prompt3.svg" alt="Prompt 3">
                    <p>Creative Response</p>
                </div>
            </div>
            </div>
            
          </div>
        </div>
      </div>
    </div>
    <div class="techrealm2">
      <div class="container">
        <div class="tech-rel2">
          <img src="{% static 'chatbot/img-edit-bot/realm.png' %}" alt="realm" />
          <br />
          <img src="{% static 'chatbot/img-edit-bot/TechRealm.png' %}" alt="realm-logo" />
        </div>
      </div>
    </div>
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <div class="ft-content2">
              <h5>Docs guide</h5>
              <p>AI has the potential to change the world. Help us democratize AI.</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="ft-content2">
              <h5>Newsletter</h5>
              <p>Get daily updates to your inbox. Subscribe to our newsletter today!</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="ft-content2">
              <h5>Social Media</h5>
              <div class="social-logo">
                <img src="{% static 'chatbot/img-edit-bot/twitter.png' %}" alt="twitter" />
                <img src="{% static 'chatbot/img-edit-bot/insta.png' %}" alt="insta" />
                <img src="{% static 'chatbot/img-edit-bot/telegram.png' %}" alt="telegram" />
              </div>
            </div>
          </div>
        </div>
        <div class="footer-end2">
          <p>&copy; 2024 TechRealm. All rights reserved.</p>
        </div>
      </div>
    </footer>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    ></script>
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
          try {
              const url = new URL(window.location.href);
              let pathnames = url.pathname.split('/');
              let urlKey = pathnames[pathnames.length - 2];
  
              const promptTemplates = {
                  open: "Answer the user's query as openly and informatively as possible. Feel free to provide additional relevant information.",
                  strict: "Be very strict with your response. Don't add anything that is not in the text.",
                  creative: "Use the information provided to answer the user's query in a creative and engaging manner. Feel free to include interesting facts or anecdotes."
              };
  
              const dropdown = document.getElementById('unique-edit-bot-id');
  
              // Fetch keys and populate the dropdown
              const data = await fetchKeys();
  
              // Determine the selected key based on the URL or default to the first one
              const selectedKey = urlKey && data.some(item => item.hash_key === urlKey)
                  ? urlKey
                  : data[0]?.hash_key;
  
              if (!selectedKey) {
                  console.error('No valid bot keys found.');
                  return;
              }
  
              console.log('Selected key:', selectedKey);
  
              // Set the dropdown value to the selected key and update content
              dropdown.value = selectedKey;
              updateContent(selectedKey);
              updateSidebarLinks(selectedKey);
  
              // Handle container clicks to send prompt data
              document.querySelectorAll('.containers').forEach(container => {
                  container.addEventListener('click', () => {
                      const promptType = container.getAttribute('data-prompt');
                      const prompt = promptTemplates[promptType];
  
                      console.log('Selected prompt:', prompt);
  
                      fetch('/chatbot/save-prompt/', {
                          method: 'POST',
                          headers: {
                              'Content-Type': 'application/json',
                              'X-CSRFToken': getCookie('csrftoken')
                          },
                          body: JSON.stringify({
                              prompt: prompt,
                              key: dropdown.value  // Always use the latest key from the dropdown
                          })
                      })
                      .then(response => response.json())
                      .then(data => {
                          alert(data.message || data.error);
                      })
                      .catch(error => {
                          console.error('Error:', error);
                      });
                  });
              });
  
          } catch (error) {
              console.error('Error initializing the document list:', error);
          }
      });
  
      // Function to fetch keys and populate the dropdown
      async function fetchKeys() {
          const response = await fetch('/chatbot/list-keys/');
          if (!response.ok) throw new Error('Error fetching keys');
  
          const data = await response.json();
          const dropdown = document.getElementById('unique-edit-bot-id');
          dropdown.innerHTML = '';  // Clear existing options
  
          if (data.length > 0) {
              data.forEach(item => {
                  const option = document.createElement('option');
                  option.value = item.hash_key;
                  option.textContent = item.model_name;
                  dropdown.appendChild(option);
              });
  
              dropdown.addEventListener('change', function () {
                  const selectedKey = this.value;
                  updateContent(selectedKey);
                  updateSidebarLinks(selectedKey);
              });
          } else {
              dropdown.style.display = 'none';  // Hide the dropdown if no keys are available
          }
  
          return data;
      }
  
      // Function to update content and refresh the URL
      function updateContent(key) {
          // Always replace the URL state to avoid adding to the history stack
          history.replaceState(null, '', `/chatbot/hub/${key}`);
          console.log(`Content updated for bot key: ${key}`);
      }
  
      // Function to update sidebar links
      function updateSidebarLinks(key) {
          document.getElementById('chat-link').href = `/chatbot/start-bot/${key}`;
          document.getElementById('file-link').href = `/chatbot/edit_bot/${key}`;
          document.getElementById('setting-link').href = `/chatbot/hub/${key}`;
          console.log(`Sidebar links updated with bot key: ${key}`);
      }
  
      // Function to get CSRF token
      function getCookie(name) {
          const cookies = document.cookie ? document.cookie.split(';') : [];
          for (const cookie of cookies) {
              const trimmedCookie = cookie.trim();
              if (trimmedCookie.startsWith(`${name}=`)) {
                  return decodeURIComponent(trimmedCookie.substring(name.length + 1));
              }
          }
          return null;
      }
  </script>
  
  </body>
</html>
